# Output Processor

The output processor is a key component in Mo AI Studio responsible for processing and transforming the raw output generated by agents. It acts as a bridge between the agent's response and the final result seen by the user. Here's how output processors work and their main types:

### How It Works

1. **Receive Raw Output**: The output processor first receives the raw text output generated by the agent.
2. **Parse and Process**: Based on predefined rules or functions, the processor parses and processes this output.
3. **Format Conversion**: The processor may convert the text into specific formats such as JSON, HTML, or Markdown.
4. **Perform Additional Operations**: Some processors may perform additional operations like calling external APIs or modifying files.
5. **Return Processed Result**: Finally, the processor returns the processed result, which could be formatted text, objects, or specific data structures.

### Main Types

1. **Default Output Processor**:
   - Function: Directly returns the raw output without any special processing.
   - Use Case: Used when no special processing of the output is required.

2. **Exa Search Processor**:
   - Function: Performs Exa search and processes the results.
   - Use Case: Used when additional search operations need to be performed based on the agent's output.

3. **File Output Processor**:
   - Function: Writes the output to a specified file.
   - Use Case: Used when the agent's output needs to be saved to the file system.

4. **Function Processor**:
   - Function: Executes custom JavaScript functions to process the output.
   - Use Case: Used when complex, customized output processing logic is needed.

### Choosing and Using Output Processors

- Choose an appropriate output processor based on task requirements.
- Output processors can be configured when creating or editing an agent.
- Some processors may require additional parameters or configuration.

Output processors greatly enhance the flexibility and functionality of Mo AI Studio, allowing agents to produce more structured, useful outputs and seamlessly integrate with other systems.

# Custom Output Processors

Output processors are a powerful feature in Mo AI Studio that allow you to customize how an agent's output is processed. This article will introduce the concept, principles, and usage of custom output processors, and provide practical code examples.

## What is an Output Processor?

An output processor is a function that receives the raw output from an agent and processes or transforms it. This feature allows you to:

1. Format the output
2. Perform additional operations (such as file writing, API calls, etc.)
3. Modify or enhance the output based on specific requirements

## How Output Processors Work

The basic workflow of an output processor is as follows:

1. Receive the raw output from the agent
2. Process or transform the output
3. Return the processed result

Here's a simple flowchart to illustrate this process:

```mermaid
graph LR
    A[Agent Output] --> B[Output Processor]
    B --> C[Processing Logic]
    C --> D[Return Result]
```

## Custom Output Processor Example

Let's look at a practical example. Here's a custom output processor in Mo AI Studio that handles file output:

```javascript
fileOutputProcessor: {
  name: "File Output Processor",
  process: async (output: string) => {
    const fileRegex = /<mo-ai-file path="([^"]+)">([\s\S]*?)<\/mo-ai-file>/g;
    const results = [];
    let match;

    while ((match = fileRegex.exec(output)) !== null) {
      const [, filePath, content] = match;
      try {
        // Get the absolute path of the file
        const absolutePath = await window.electronAPI.file.getAbsolutePath(filePath);
        // Write the file content
        await window.electronAPI.file.writeFile(absolutePath, content.trim());
        console.log(`File written: ${absolutePath}`);
        results.push({ path: filePath, status: "success" });
        message.success(`File ${filePath} has been successfully written`);
      } catch (error) {
        console.error(`Error writing file: ${filePath}`, error);
        results.push({ path: filePath, status: "error", message: error.message });
        message.error(`Failed to write file ${filePath}: ${error.message}`);
      }
    }

    return results;
  },
  resultComponent: DevProcessorResult,
}
```

This processor works as follows:

1. Uses a regular expression to find special `<mo-ai-file>` tags in the output.
2. For each matched file, it attempts to write the file content.
3. Records the processing result (success or failure) for each file.
4. Returns an array of processing results.

## How to Use Custom Output Processors

To use a custom output processor, you need to specify it when creating or configuring an agent. For example:

```javascript
const myAgent = {
  // Other configurations...
  outputProcessor: "fileOutputProcessor",
  // ...
};
```

This way, when the agent generates output, it will automatically use the specified processor to process the output.

## Creating Your Own Output Processor

You can create custom output processors based on your own needs. Here are the basic steps to create a custom processor:

1. Define an object containing a `name` and a `process` function.
2. Implement your processing logic in the `process` function.
3. Optional: Add a `resultComponent` to customize how the result is displayed.

For example, here's a simple custom processor that converts the output to uppercase:

```javascript
const uppercaseProcessor = {
  name: "Uppercase Processor",
  process: (output: string) => {
    return output.toUpperCase();
  }
};
```